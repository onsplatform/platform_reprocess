FROM python:3.7-stretch

RUN apt-get -y update && apt-get -y upgrade && apt-get install git -y cron

RUN git clone https://github.com/onsplatform/platform_reprocess.git /var/worker/reprocess

RUN apt-get -y update && apt-get -y upgrade && apt-get -y install git

WORKDIR /var/worker/reprocess

RUN pip install pipenv
RUN pipenv install --dev --system --deploy

CMD celery -A reprocess.discovery:app worker --loglevel=info
FROM python:3.7-stretch

RUN apt-get -y update && apt-get -y upgrade && apt-get install git -y cron

RUN git clone https://github.com/onsplatform/platform_reprocess.git /var/cron/reprocess

WORKDIR /var/cron/reprocess

RUN mkdir /var/cron/reprocess/log

RUN pip install pipenv
RUN pipenv install

RUN chmod +x /var/cron/reprocess/deploy/reprocess.sh
RUN ./var/cron/reprocess/deploy/reprocess.sh

RUN crontab /var/cron/reprocess/scheduler.txt

CMD cron && tail -f /var/cron/reprocess/log/reprocess_cron.log
